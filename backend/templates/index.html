<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="keywords" content="depression test, meditation, mental health" />
  <meta name="description" content="A platform offering depression tests and meditation resources for mental well-being." />
  <meta name="author" content="" />
  <link rel="shortcut icon" href="../static/assetes/images/favicon.png" type="image/x-icon">

  <title>Depression Test & Meditation</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="../static/assetes/css/bootstrap.css" />

  <!-- Fonts style -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!-- Owl slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

  <!-- Font Awesome style -->
  <link href="../static/assetes/css/font-awesome.min.css" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="../static/assetes/css/style.css" rel="stylesheet" />
  <link href="../static/assetes/css/responsive.css" rel="stylesheet" />

  <!-- Custom styles for navbar buttons and modals -->
  <style>
    .custom_nav-container {
      background-color: #178066;
      padding: 10px 15px;
    }
    .navbar-brand span {
      color: #ffffff;
    }
    .navbar-nav .nav-link {
      color: #ffffff;
    }
    .navbar-nav .nav-link:hover {
      color: #f7444e;
    }
    .nav_search-btn {
      background-color: transparent;
      border: none;
      color: #ffffff;
    }
    .nav_search-btn:hover {
      color: #f7444e;
    }
    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(255, 255, 255, 1)' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
    .auth-buttons .nav-link {
      border: 2px solid #ffffff;
      border-radius: 5px;
      padding: 5px 15px;
      margin: 0 5px;
      color: #ffffff;
    }
    .auth-buttons .nav-link:hover {
      background-color: #f7444e;
      border-color: #f7444e;
      color: #ffffff;
    }
    .profile-button .nav-link {
      color: #ffffff;
      font-weight: 500;
    }
    .profile-button .nav-link:hover {
      color: #f7444e;
    }
    .modal-content {
      border-radius: 10px;
      padding: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      font-weight: 500;
      color: #333;
    }
    .form-group input {
      border-radius: 5px;
    }
    .btn-custom {
      background-color: #f7444e;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      width: 100%;
    }
    .btn-custom:hover {
      background-color: #d9363e;
    }
    .error-message {
      color: #f7444e;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .profile-details p {
      font-size: 16px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="hero_area">
    <div class="hero_bg_box">
      <img src="../static/assetes/images/hero-bg.png" alt="Hero Background">
    </div>

    <!-- Header section starts -->
    <header class="header_section">
      <div class="container">
        <nav class="navbar navbar-expand-lg custom_nav-container">
          <a class="navbar-brand" href="#">
            <span>Depression Test & Meditation</span>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class=""></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav auth-buttons">
              <li class="nav-item" id="login-nav">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#loginModal">Login</a>
              </li>
              <li class="nav-item" id="register-nav">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#registerModal">Register</a>
              </li>
              <li class="nav-item profile-button" id="profile-nav" style="display: none;">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#profileModal"><i class="fa fa-user" aria-hidden="true"></i> Profile</a>
              </li>
            </ul>
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="#home">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#about">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#services">Services</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#experts">Experts</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#contact">Contact Us</a>
              </li>
              <form class="form-inline">
                <button class="btn my-2 my-sm-0 nav_search-btn" type="submit">
                  <i class="fa fa-search" aria-hidden="true"></i>
                </button>
              </form>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!-- End header section -->

    <!-- Slider section -->
    <section id="home" class="slider_section">
      <div id="customCarousel1" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="container">
              <div class="row">
                <div class="col-md-7">
                  <div class="detail-box">
                    <h1>Take Control of Your Mental Health</h1>
                    <p>Discover our depression test and guided meditation resources to help you find peace and understanding in your daily life.</p>
                    <div class="btn-box">
                      <a href="test" class="btn1">Start Test Now</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <div class="container">
              <div class="row">
                <div class="col-md-7">
                  <div class="detail-box">
                    <h1>Find Inner Calm with Meditation</h1>
                    <p>Our expertly designed meditation sessions can help reduce stress and support your journey to mental wellness.</p>
                    <div class="btn-box">
                      <a href="" class="btn1">Explore Meditation</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <div class="container">
              <div class="row">
                <div class="col-md-7">
                  <div class="detail-box">
                    <h1>Understand Your Emotions</h1>
                    <p>Take our simple depression test to gain insights into your mental state and receive personalized recommendations.</p>
                    <div class="btn-box">
                      <a href="" class="btn1">Learn More</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <ol class="carousel-indicators">
          <li data-target="#customCarousel1" data-slide-to="0" class="active"></li>
          <li data-target="#customCarousel1" data-slide-to="1"></li>
          <li data-target="#customCarousel1" data-slide-to="2"></li>
        </ol>
      </div>
    </section>
    <!-- End slider section -->
  </div>

  <!-- Services section -->
  <section id="services" class="department_section layout_padding">
    <div class="department_container">
      <div class="container">
        <div class="heading_container heading_center">
          <h2>Our Services</h2>
          <p>We offer a range of tools and resources to support your mental health journey.</p>
        </div>
        <div class="row">
          <div class="col-md-3">
            <div class="box">
              <div class="img-box">
                <img src="../static/assetes/images/s1.png" alt="Depression Test">
              </div>
              <div class="detail-box">
                <h5>Depression Test</h5>
                <p>A quick and confidential assessment to evaluate your mental state.</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="box">
              <div class="img-box">
                <img src="../static/assetes/images/s2.png" alt="Guided Meditation">
              </div>
              <div class="detail-box">
                <h5>Guided Meditation</h5>
                <p>Audio sessions to help you relax and manage stress effectively.</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="box">
              <div class="img-box">
                <img src="../static/assetes/images/s3.png" alt="Counseling">
              </div>
              <div class="detail-box">
                <h5>Counseling Support</h5>
                <p>Connect with professionals for personalized guidance.</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="box">
              <div class="img-box">
                <img src="../static/assetes/images/s4.png" alt="Self-Help">
              </div>
              <div class="detail-box">
                <h5>Self-Help Resources</h5>
                <p>Articles and tips to empower your mental wellness.</p>
              </div>
            </div>
          </div>
        </div>
        <div class="btn-box">
          <a href="">View All Services</a>
        </div>
      </div>
    </div>
  </section>
  <!-- End services section -->

  <!-- About section -->
  <section id="about" class="about_section layout_margin-bottom">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <div class="img-box">
            <img src="../static/assetes/images/about-img.jpg" alt="About Us">
          </div>
        </div>
        <div class="col-md-6">
          <div class="detail-box">
            <div class="heading_container">
              <h2>About <span>Us</span></h2>
            </div>
            <p>We are dedicated to helping individuals understand and improve their mental health through accessible depression tests and meditation practices. Our mission is to provide tools and support for a calmer, healthier mind.</p>
            <a href="">Read More</a>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- End about section -->

  <!-- Experts section -->
  <section id="experts" class="doctor_section layout_padding">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>Our Experts</h2>
        <p class="col-md-10 mx-auto px-0">Meet our team of mental health professionals and meditation guides who are here to support you.</p>
      </div>
      <div class="row">
        <div class="col-sm-6 col-lg-4 mx-auto">
          <div class="box">
            <div class="img-box">
              <img src="../static/assetes/images/d1.jpg" alt="Elina Josh">
            </div>
            <div class="detail-box">
              <div class="social_box">
                <a href=""><i class="fa fa-facebook" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-twitter" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-youtube" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-linkedin" aria-hidden="true"></i></a>
              </div>
              <h5>Elina Josh</h5>
              <h6>Therapist</h6>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 mx-auto">
          <div class="box">
            <div class="img-box">
              <img src="../static/assetes/images/d2.jpg" alt="Adam View">
            </div>
            <div class="detail-box">
              <div class="social_box">
                <a href=""><i class="fa fa-facebook" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-twitter" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-youtube" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-linkedin" aria-hidden="true"></i></a>
              </div>
              <h5>Adam View</h5>
              <h6>Meditation Coach</h6>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 mx-auto">
          <div class="box">
            <div class="img-box">
              <img src="../static/assetes/images/d3.jpg" alt="Mia Mike">
            </div>
            <div class="detail-box">
              <div class="social_box">
                <a href=""><i class="fa fa-facebook" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-twitter" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-youtube" aria-hidden="true"></i></a>
                <a href=""><i class="fa fa-linkedin" aria-hidden="true"></i></a>
              </div>
              <h5>Mia Mike</h5>
              <h6>Psychologist</h6>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-box">
        <a href="">View All Experts</a>
      </div>
    </div>
  </section>
  <!-- End experts section -->

  <!-- Contact section -->
  <section id="contact" class="contact_section layout_padding">
    <div class="container">
      <div class="heading_container">
        <h2>Get In Touch</h2>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="form_container contact-form">
            <form action="">
              <div class="form-row">
                <div class="col-lg-6">
                  <div>
                    <input type="text" placeholder="Your Name" />
                  </div>
                </div>
                <div class="col-lg-6">
                  <div>
                    <input type="text" placeholder="Phone Number" />
                  </div>
                </div>
              </div>
              <div>
                <input type="email" placeholder="Email" />
              </div>
              <div>
                <input type="text" class="message-box" placeholder="Message" />
              </div>
              <div class="btn_box">
                <button>SEND</button>
              </div>
            </form>
          </div>
        </div>
        <div class="col-md-6">
          <div class="map_container">
            <div class="map">
              <div id="googleMap"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- End contact section -->

  <!-- Testimonial section -->
  <section class="client_section layout_padding-bottom">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>Testimonials</h2>
      </div>
      <div id="carouselExample2Controls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="row">
              <div class="col-md-11 col-lg-10 mx-auto">
                <div class="box">
                  <div class="img-box">
                    <img src="../static/assetes/images/client.jpg" alt="Alan Emerson" />
                  </div>
                  <div class="detail-box">
                    <div class="name">
                      <h6>Alan Emerson</h6>
                    </div>
                    <p>The depression test gave me clarity about my feelings, and the meditation sessions helped me find peace after a long time.</p>
                    <i class="fa fa-quote-left" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <div class="row">
              <div class="col-md-11 col-lg-10 mx-auto">
                <div class="box">
                  <div class="img-box">
                    <img src="../static/assetes/images/client.jpg" alt="Sara K." />
                  </div>
                  <div class="detail-box">
                    <div class="name">
                      <h6>Sara K.</h6>
                    </div>
                    <p>The guided meditations are a lifesaver! I feel more in control of my stress now.</p>
                    <i class="fa fa-quote-left" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <div class="row">
              <div class="col-md-11 col-lg-10 mx-auto">
                <div class="box">
                  <div class="img-box">
                    <img src="../static/assetes/images/client.jpg" alt="John M." />
                  </div>
                  <div class="detail-box">
                    <div class="name">
                      <h6>John M.</h6>
                    </div>
                    <p>Taking the test was the first step to understanding my mental health. Highly recommend this platform!</p>
                    <i class="fa fa-quote-left" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="carousel_btn-container">
          <a class="carousel-control-prev" href="#carouselExample2Controls" role="button" data-slide="prev">
            <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExample2Controls" role="button" data-slide="next">
            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </section>
  <!-- End testimonial section -->

  <!-- Login Modal -->
  <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModalLabel">Login</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="loginForm">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input type="email" class="form-control" id="loginEmail" placeholder="Enter email" required>
              <div id="loginEmailError" class="error-message">Please enter a valid email.</div>
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input type="password" class="form-control" id="loginPassword" placeholder="Enter password" required>
              <div id="loginPasswordError" class="error-message">Incorrect email or password.</div>
            </div>
            <button type="submit" class="btn-custom">Login</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Register Modal -->
  <div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="registerModalLabel">Register</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="registerForm">
            <div class="form-group">
              <label for="registerName">Full Name</label>
              <input type="text" class="form-control" id="registerName" placeholder="Enter full name" required>
              <div id="registerNameError" class="error-message">Please enter your full name.</div>
            </div>
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input type="email" class="form-control" id="registerEmail" placeholder="Enter email" required>
              <div id="registerEmailError" class="error-message">Email already registered.</div>
            </div>
            <div class="form-group">
              <label for="registerPassword">Password</label>
              <input type="password" class="form-control" id="registerPassword" placeholder="Enter password" required>
              <div id="registerPasswordError" class="error-message">Password must be at least 6 characters.</div>
            </div>
            <button type="submit" class="btn-custom">Register</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="profileModalLabel">User Profile</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="profile-details">
            <p><strong>Name:</strong> <span id="profileName"></span></p>
            <p><strong>Email:</strong> <span id="profileEmail"></span></p>
            <p><strong>Test History:</strong> No test results available.</p>
          </div>
          <button class="btn-custom" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer section -->
  <footer class="footer_section">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-lg-3 footer_col">
          <div class="footer_contact">
            <h4>Reach at..</h4>
            <div class="contact_link_box">
              <a href="">
                <i class="fa fa-map-marker" aria-hidden="true"></i>
                <span>Location</span>
              </a>
              <a href="">
                <i class="fa fa-phone" aria-hidden="true"></i>
                <span>Call +01 1234567890</span>
              </a>
              <a href="">
                <i class="fa fa-envelope" aria-hidden="true"></i>
                <span>support@depressionhelp.com</span>
              </a>
            </div>
          </div>
          <div class="footer_social">
            <a href=""><i class="fa fa-facebook" aria-hidden="true"></i></a>
            <a href=""><i class="fa fa-twitter" aria-hidden="true"></i></a>
            <a href=""><i class="fa fa-linkedin" aria-hidden="true"></i></a>
            <a href=""><i class="fa fa-instagram" aria-hidden="true"></i></a>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 footer_col">
          <div class="footer_detail">
            <h4>About</h4>
            <p>We provide accessible mental health resources, including depression tests and meditation, to help you achieve a balanced and peaceful life.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-2 mx-auto footer_col">
          <div class="footer_link_box">
            <h4>Links</h4>
            <div class="footer_links">
              <a class="active" href="#home">Home</a>
              <a href="#about">About</a>
              <a href="#services">Services</a>
              <a href="#experts">Experts</a>
              <a href="#contact">Contact Us</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 footer_col">
          <h4>Newsletter</h4>
          <form action="#">
            <input type="email" placeholder="Enter email" />
            <button type="submit">Subscribe</button>
          </form>
        </div>
      </div>
      <div class="footer-info">
        <p>
          © <span id="displayYear"></span> All Rights Reserved By
          <a href="https://html.design/">Depression Test</a><br><br>
        </p>
      </div>
    </div>
  </footer>
  <!-- End footer section -->

  <!-- jQuery -->
  <script type="text/javascript" src="../static/assetes/js/jquery-3.4.1.min.js"></script>
  <!-- Popper js -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <!-- Bootstrap js -->
  <script type="text/javascript" src="../static/assetes/js/bootstrap.js"></script>
  <!-- Owl slider -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <!-- Custom js -->
  <script type="text/javascript" src="../static/assetes/js/custom.js"></script>
  <!-- Google Map -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap"></script>

  <script>
    // Validate JWT token format
    function isValidToken(token) {
      return token && /^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(token);
    }

    // Update navbar based on login status
    function updateNavbar() {
      const token = localStorage.getItem('jwtToken');
      if (token && isValidToken(token)) {
        document.getElementById('login-nav').style.display = 'none';
        document.getElementById('register-nav').style.display = 'none';
        document.getElementById('profile-nav').style.display = 'block';
      } else {
        document.getElementById('login-nav').style.display = 'block';
        document.getElementById('register-nav').style.display = 'block';
        document.getElementById('profile-nav').style.display = 'none';
        localStorage.removeItem('jwtToken'); // Clear invalid token
      }
    }

    // Handle login form submission
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const loginEmailError = document.getElementById('loginEmailError');
      const loginPasswordError = document.getElementById('loginPasswordError');

      loginEmailError.style.display = 'none';
      loginPasswordError.style.display = 'none';

      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        loginEmailError.style.display = 'block';
        return;
      }

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await response.json();

        if (response.ok) {
          if (isValidToken(data.token)) {
            localStorage.setItem('jwtToken', data.token);
            $('#loginModal').modal('hide');
            updateNavbar();
            document.getElementById('loginForm').reset();
          } else {
            loginPasswordError.textContent = 'Invalid token received from server.';
            loginPasswordError.style.display = 'block';
          }
        } else {
          loginPasswordError.textContent = data.message || 'Incorrect email or password.';
          loginPasswordError.style.display = 'block';
        }
      } catch (error) {
        loginPasswordError.textContent = 'Server error. Please try again later.';
        loginPasswordError.style.display = 'block';
      }
    });

    // Handle register form submission
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('registerName').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const nameError = document.getElementById('registerNameError');
      const emailError = document.getElementById('registerEmailError');
      const passwordError = document.getElementById('registerPasswordError');

      nameError.style.display = 'none';
      emailError.style.display = 'none';
      passwordError.style.display = 'none';

      if (!name) {
        nameError.style.display = 'block';
        return;
      }
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        emailError.textContent = 'Please enter a valid email.';
        emailError.style.display = 'block';
        return;
      }
      if (password.length < 6) {
        passwordError.style.display = 'block';
        return;
      }

      try {
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password })
        });
        const data = await response.json();

        if (response.ok) {
          if (isValidToken(data.token)) {
            localStorage.setItem('jwtToken', data.token);
            $('#registerModal').modal('hide');
            updateNavbar();
            document.getElementById('registerForm').reset();
          } else {
            emailError.textContent = 'Invalid token received from server.';
            emailError.style.display = 'block';
          }
        } else {
          emailError.textContent = data.message || 'Email already registered.';
          emailError.style.display = 'block';
        }
      } catch (error) {
        emailError.textContent = 'Server error. Please try again later.';
        emailError.style.display = 'block';
      }
    });

    // Populate profile modal
    $('#profileModal').on('show.bs.modal', async function() {
      const token = localStorage.getItem('jwtToken');
      if (!token || !isValidToken(token)) {
        $('#profileModal').modal('hide');
        alert('Invalid or missing session. Please log in again.');
        localStorage.removeItem('jwtToken');
        updateNavbar();
        return;
      }

      try {
        const response = await fetch('/api/profile', {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();

        if (response.ok) {
          document.getElementById('profileName').textContent = data.name || 'N/A';
          document.getElementById('profileEmail').textContent = data.email;
        } else {
          alert(data.message || 'Failed to load profile. Please log in again.');
          localStorage.removeItem('jwtToken');
          updateNavbar();
          $('#profileModal').modal('hide');
        }
      } catch (error) {
        alert('Server error. Please try again later.');
        $('#profileModal').modal('hide');
      }
    });

    // Handle logout
    function logout() {
      localStorage.removeItem('jwtToken');
      $('#profileModal').modal('hide');
      updateNavbar();
      // Optional: Notify server of logout (if using token blacklist)
      fetch('/api/logout', {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${localStorage.getItem('jwtToken')}` }
      }).catch(error => console.error('Logout error:', error));
    }

    // Initialize navbar on page load
    window.onload = function() {
      updateNavbar();
    };
  </script>
</body>
</html>
